<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<title>ChillTrip's member registration</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="Free HTML Templates" name="keywords">
<meta content="Free HTML Templates" name="description">

<!-- Favicon -->
<link href="img/favicon.ico" rel="icon" />

<!-- Google Web Fonts -->
<link rel="preconnect" href="https://fonts.gstatic.com" />
<link
	href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
	rel="stylesheet" />

<!-- Font Awesome -->
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css"
	rel="stylesheet" />

<!-- Customized Bootstrap Stylesheet -->
<link th:href="@{/css/style.css}" rel="stylesheet" />
<link th:href="@{/css/yuki_style.css}" rel="stylesheet" />
<style>
.breadcrumb {
	background-color: transparent;
	/* 移除背景色 */
	list-style: none;
	/* 移除列表樣式 */
	display: flex;
	padding: 0;
	margin: 1rem 0;
}

.breadcrumb-item {
	font-size: calc(1rem - 4px);
	/* 比 dropdown-item 小 4px */
	color: #6c757d !important;
	/* 預設顯示為灰色，並覆蓋 Bootstrap 預設樣式 */
	text-decoration: none;
	display: inline-block;
	padding: 0.25rem 0.75rem;
}

.breadcrumb-item+.breadcrumb-item::before {
	content: ">";
	padding: 0 0.5rem;
	color: #6c757d;
}

.breadcrumb-item a {
	color: #6c757d !important;
	/* 更改 a 標籤的預設顏色為灰色 */
	text-decoration: none;
	/* 移除下劃線 */
}

.breadcrumb-item a:hover {
	color: #FF6600 !important;
	/* 滑鼠移動到 a 標籤上時顯示為橘色 */
}

.breadcrumb-item.active {
	color: #FF6600 !important;
	/* 最後一個元素顯示為橘色，並覆蓋 Bootstrap 預設樣式 */
}

main {
	margin-top: 80px;
}

* {
	margin: 0;
	padding: 0;
	box-sizing: border-box;
	font-family: Arial, sans-serif;
}

body {
	background-color: #f5f5f5;
}

.header {
	padding: 10px 0;
}

.header-content {
	max-width: 1200px;
	margin: 0 auto;
	display: flex;
	align-items: center;
	justify-content: space-between;
	padding: 0 20px;
}

.logo {
	font-size: 24px;
	color: #333;
	text-decoration: none;
}

.nav-links a {
	margin-left: 20px;
	text-decoration: none;
	color: #666;
}

.container {
	max-width: 600px;
	margin: 40px auto;
	padding: 20px;
	background: white;
	border-radius: 8px;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
	position: relative;
	top: -50px;
}

h2 {
	text-align: center;
	color: #333;
	margin-bottom: 30px;
}

.form-group {
	margin-bottom: 20px;
	position: relative;
}

.form-group label {
	display: block;
	margin-bottom: 5px;
	color: #666;
}

.required::after {
	content: '*';
	color: #ff4444;
	margin-left: 4px;
}

input {
	width: 100%;
	padding: 10px;
	border: 1px solid #ddd;
	border-radius: 4px;
	font-size: 14px;
}

.password-toggle {
	position: absolute;
	right: 10px;
	top: 35px;
	cursor: pointer;
	background: none;
	border: none;
	padding: 0;
	width: 24px;
	height: 24px;
	display: flex;
	align-items: center;
	justify-content: center;
}

.password-toggle svg {
	width: 20px;
	height: 20px;
	fill: #333;
}

.password-toggle .eye-open, .password-toggle.visible .eye-closed {
	display: none;
}

.password-toggle .eye-closed, .password-toggle.visible .eye-open {
	display: block;
}

.verify-button {
	position: absolute;
	right: 5px;
	top: 32px;
	padding: 5px 10px;
	background: #666;
	color: white;
	border: none;
	border-radius: 4px;
	cursor: pointer;
}

.register-button {
	width: 100%;
	padding: 12px;
	background: #FF6600;
	color: white;
	border: none;
	border-radius: 4px;
	cursor: pointer;
	font-size: 16px;
	margin-top: 20px;
}

.submit-button:hover {
	background: #FF6600;
}

.login-link {
	display: block;
	margin-top: 20px;
	/* 與上方註冊按鈕的間距 */
	text-align: center;
	/* 文字置中 */
	color: #333;
	text-decoration: none;
	/* 去除底線 */
}

.social-links {
	margin-bottom: 10px;
}

.social-links a {
	margin: 0 10px;
	color: #333;
	text-decoration: none;
}

select {
	width: 100%;
	padding: 10px;
	border: 1px solid #ddd;
	border-radius: 4px;
	font-size: 14px;
}

/* Modal Styles */
.modal {
	display: none;
	justify-content: center;
	align-items: center;
	padding: 1rem;
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	z-index: 9999;
}

.modal-content {
	background-color: white;
	padding: 1.5rem;
	border-radius: 8px;
	text-align: center;
	width: 90%;
	max-width: 400px;
	box-sizing: border-box;
}

/* Success Modal */
.success .modal-content {
	border: 2px solid #4CAF50;
	background-color: #d4edda;
	color: #155724;
}

/* Confirm Button Style */
.modal-btn {
	padding: 8px 16px;
	border-radius: 4px;
	cursor: pointer;
	font-size: 14px;
	border: none;
	background-color: #FF6600;
	color: white;
	transition: 0.3s;
}

/* Hover Effect for the Button */
.modal-btn:hover {
	background-color: #e65c00;
}

.modal-buttons {
	margin-top: 1.5rem;
	display: flex;
	justify-content: center;
	gap: 1rem;
}

.show {
	display: flex;
}
</style>
</head>

<body>
	<div class="col-lg-9">
		<nav
			class="navbar navbar-expand-lg bg-light navbar-light py-3 py-lg-0 px-0">
	</div>
		<!------網站header------>
	<div id="app">
		<header>
			<nav class="top-nav">
				<div class="nav-left">
					<a href="#" class="nav-item nav-link" id="nav-go">Go！行程</a> <a
						href="#" class="nav-item nav-link" id="nav-mygo">我的行程</a>
				</div>
				<div class="nav-center">
					<a href="#" id="z-index"> <a href="/TIA104G2-SpringBoot/"
						id="z-index"> <img th:src="@{/img/logo_black.png}"
							alt="Chill Trip" style="width: 150px; height: auto" />
					</a>
					</a>
				</div>
				<div class="nav-right">
					<a href="/TIA104G2-SpringBoot/login"
						class="nav-item nav-link  active" id="nav-login"
						style="color: #FF6600;">登入/註冊</a> <a href="#"
						class="nav-item nav-link" id="nav-profile">會員基本資料</a> <a href="#"
						class="nav-item nav-link" id="nav-support">客服中心</a>
				</div>
			</nav>
		</header>
	</div>

	<!------網站Breadcrumb Navigation（麵包屑導航）------>
	<div aria-label="breadcrumb">
		<ul class="breadcrumb" id="breadcrumb-nav">
			<!-- 麵包屑導航項目將由 JavaScript 動態生成 -->
		</ul>
	</div>


	<div class="container">
		<form id="registrationForm" method="post" action="/member/register" enctype="multipart/form-data">
			<div class="form-group">
				<p>如果您未曾建立 ChillTrip.com 的帳戶，請填寫以下資訊註冊新帳戶。</p>
				<p style="color: #ff4444">*為必填項目</p>
			</div>

			<div class="form-group">
				<label class="required">會員暱稱</label> <input type="text"
					id="username" name="nickName" placeholder="輸入暱稱" required>

			</div>

			<div class="form-group">
				<label class="required">真實姓名</label> <input type="text"
					id="realname" name="name" placeholder="輸入姓名" required>
			</div>

			<div class="form-group">
				<label class="required">性別</label> <select id="gender" name="gender"
					required>
					<option value="">請選擇性別</option>
					<option value="男性">男性</option>
					<option value="女性">女性</option>
				</select>
			</div>

			<div class="form-group">
				<label>生日</label> <input type="date" id="birthday" name="birthday">
			</div>

			<div class="form-group">
				<label class="required">聯絡電話</label> <input type="tel" id="phone"
					name="phone" placeholder="輸入聯絡電話" required>
			</div>

			<div class="form-group">
				<label class="required">電子信箱</label> <input type="email" id="email"
					name="email" placeholder="輸入電子信箱" required>
				<button type="button" class="verify-button" name="randomcode">傳送驗證碼</button>
			</div>

			<div class="form-group">
				<label class="required">信箱驗證碼</label> <input type="text"
					id="emailCode" name="emailCode" placeholder="輸入驗證碼" required>
				<button type="button" class="verify-button" name="checkrandomcode">確認驗證碼</button>
			</div>

			<div class="form-group">
				<label class="required">密碼</label> <input type="password"
					id="password" name="password" placeholder="輸入密碼" required>
				<button type="button" class="password-toggle" data-target="password">
					<svg class="eye-open" viewBox="0 0 24 24">
              <path
							d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" />
            </svg>
					<svg class="eye-closed" viewBox="0 0 24 24">
              <path
							d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z" />
            </svg>
				</button>
			</div>

			<div class="form-group">
				<label class="required">密碼確認</label> <input type="password"
					id="confirmPassword" placeholder="再次輸入密碼" required>
				<button type="button" class="password-toggle"
					data-target="confirmPassword">
					<svg class="eye-open" viewBox="0 0 24 24">
              <path
							d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" />
            </svg>
					<svg class="eye-closed" viewBox="0 0 24 24">
              <path
							d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z" />
            </svg>
				</button>
				<!-- 錯誤訊息顯示區域 -->
				<div id="passwordError"
					style="color: #ff4444; font-size: 14px; display: none;">密碼輸入不一致</div>
			</div>

			<div class="form-group">
				<label>公司統編</label> <input type="text" id="company" name="companyId"
					placeholder="輸入公司統編">
			</div>

			<div class="form-group">
				<label>手機載具</label> <input type="text" id="mobile"
					name="ereceiptCarrier" placeholder="輸入手機載具">
			</div>

			<div class="form-group">
				<label>信用卡號</label> <input type="text" id="creditCard"
					name="creditCard" placeholder="輸入信用卡號">
			</div>
			<div class="form-group">
				<label for="photo">上傳頭貼：</label> <input type="file" id="photo"
					name="photo" accept="image/*"><br> <br>
			</div>
			<input type="hidden" name="register" value="register"> <input
				type="submit" class="register-button" value="註冊" /> <a
				href="/TIA104G2-SpringBoot/login" class="login-link" style="color: #ff4444;">已有帳號?點擊登入</a>
		</form>
	</div>
	</main>

	<!-- 成功談窗 -->
	<div class="modal" id="successModal">
		<div class="modal-content">
			<p>註冊成功！</p>
			<div class="modal-buttons">
				<button class="modal-btn confirm-btn" id="confirmBtn">確認</button>
			</div>
		</div>
	</div>

	<footer>
		<div class="social-links">
			<div style="display: flex; gap: 10px;">
				<a href="https://facebook.com" target="_blank"
					style="text-decoration: none;">
					<div
						style="width: 50px; height: 50px; background-color: #3b5998; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
						<i class="fab fa-facebook-f"
							style="color: white; font-size: 24px;"></i>
					</div>
				</a> <a href="https://instagram.com" target="_blank"
					style="text-decoration: none;">
					<div
						style="width: 50px; height: 50px; background-color: #E1306C; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
						<i class="fab fa-instagram" style="color: white; font-size: 24px;"></i>
					</div>
				</a> <a href="https://youtube.com" target="_blank"
					style="text-decoration: none;">
					<div
						style="width: 50px; height: 50px; background-color: #FF0000; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
						<i class="fab fa-youtube" style="color: white; font-size: 24px;"></i>
					</div>
				</a>
			</div>

			<!-- 加載 Font Awesome 圖標庫 -->
			<link
				href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
				rel="stylesheet">

		</div>
		<div class="copyright">Copyright © 2024 良心鮪魚股份有限公司</div>
	</footer>

	<!------ 共用JS ------>
	<!-- Back to Top -->
	<a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i
		class="fa fa-angle-double-up"></i></a>

	<!-- JavaScript Libraries -->
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script
		src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>

	<!-- 本地資源改用 Thymeleaf 語法 -->
	<script th:src="@{/lib/easing/easing.min.js}"></script>
	<script th:src="@{/lib/owlcarousel/owl.carousel.min.js}"></script>

	<!-- Contact Javascript File -->
	<script th:src="@{/mail/jqBootstrapValidation.min.js}"></script>
	<script th:src="@{/mail/contact.js}"></script>

	<!-- Template Javascript -->
	<script th:src="@{/js/main.js}"></script>

	<!-- 導航欄nav的href載入器 -->
	<!------修齊的JS------>
	<script th:src="@{/js/navigation.js}"></script>

	<!-- 導航欄nav的href載入器 -->
	<script>
    document.addEventListener("DOMContentLoaded", function () {
      document.getElementById("nav-go").href = "./go.html";
      document.getElementById("nav-product").href = "./product.html";
      document.getElementById("nav-profile").href = "./profile.html";
      document.getElementById("nav-guide").href = "./guide.html";
      document.getElementById("nav-basic-info").href = "./basic_info.html";
      document.getElementById("nav-coupons").href = "./coupons.html";
      document.getElementById("nav-orders").href = "./orders.html";
      document.getElementById("nav-support").href = "./support.html";
      document.getElementById("nav-cart").href = "./cart.html";
      document.getElementById("nav-index").href = "./index.html";
    });
  </script>
	<script>
    const contextPath = "/TIA104G2-SpringBoot"; // 從後端傳來的 context-path
    // 發送驗證碼
    $(document).ready(function () {
    $("button[name='randomcode']").click(function () {
        const email = $("#email").val();

        if (!email) {
            alert("請輸入電子信箱");
            return;
        }

        $.ajax({
            type: "POST",
            url: contextPath + "/member/randomcode",
            data: { email: email },
            success: function (response) {
                alert(response); // 提示發送成功
            },
            error: function (xhr, status, error) {
                // 顯示自訂錯誤訊息
                if (xhr.status === 404) {
                    alert("找不到該路徑，請檢查 URL 或後端設定");
                } else if (xhr.status === 500) {
                    alert("伺服器內部錯誤，請稍後再試");
                } else {
                    alert(xhr.responseText || "發送驗證碼時發生錯誤");
                }
            }
        });
    });
});


    // 確認驗證碼
    $(document).ready(function () {
        $("button[name='checkrandomcode']").click(function () {
            const email = $("#email").val();
            const emailCode = $("#emailCode").val();

            if (!email || !emailCode) {
                alert("請輸入電子信箱及驗證碼");
                return;
            }

            $.ajax({
                type: "POST",
                url: contextPath + "/member/checkrandomcode",
                data: { email: email, emailCode: emailCode },
                success: function (response) {
                    alert(response); // 提示驗證成功
                },
                error: function (xhr) {
                    alert(xhr.responseText || "驗證碼驗證失敗");
                }
            });
        });
    });

    // 密碼顯示開關功能
    document.querySelectorAll('.password-toggle').forEach(button => {
        button.addEventListener('click', function () {
            const target = document.getElementById(this.getAttribute('data-target'));
            const isVisible = target.type === 'text'; // 檢查是否顯示密碼
            target.type = isVisible ? 'password' : 'text'; // 切換密碼顯示/隱藏
            this.classList.toggle('visible', !isVisible); // 切換 eye-icon
        });
    });

    // 監聽表單提交
    document.getElementById("registrationForm").addEventListener("submit", function (event) {
        event.preventDefault(); // 防止表單提交刷新頁面

        // 檢查密碼與確認密碼是否一致
        const password = document.getElementById("password").value;
        const confirmPassword = document.getElementById("confirmPassword").value;

        if (password !== confirmPassword) {
            document.getElementById("passwordError").style.display = 'block'; // 顯示錯誤訊息
        } else {
            document.getElementById("passwordError").style.display = 'none'; // 隱藏錯誤訊息
            submitForm(); // 呼叫提交表單的函數
        }
    });

    
    // 會員註冊
    function submitForm() {
        const formData = new FormData($("#registrationForm")[0]);

        // 動態構建 memberVO 資料
        const memberVO = {
            nickName: $("#username").val(),
            name: $("#realname").val(),
            phone: $("#phone").val(),
            email: $("#email").val(),
            password: $("#password").val(),
            gender: $("#gender").val(),
            birthday: $("#birthday").val(),
            companyId: $("#company").val(),
            ereceiptCarrier: $("#mobile").val(),
            creditCard: $("#creditCard").val()
        };

        // 確保將 memberVO 的資料打包進 FormData
        formData.append("memberVO", JSON.stringify(memberVO));

        // 處理照片上傳
        const photo = $("#photo")[0].files[0];
        if (photo) {
            formData.append("photo", photo);
        }

        // 發送 AJAX 請求
        $.ajax({
            type: "POST",
            url: contextPath + "/member/register",
            data: formData,
            contentType: false,  // 不設置 contentType，讓瀏覽器自動處理
            processData: false,  // 不處理資料，讓 FormData 自動處理
            success: function(response) {
                alert("註冊成功！");
                showSuccessModal();
                window.location.href = contextPath + "/login"; // 註冊成功後跳轉
            },
            error: function(xhr) {
                let errorMessage = "註冊失敗，請稍後再試";
                if (xhr.responseJSON && xhr.responseJSON.message) {
                    errorMessage = xhr.responseJSON.message;
                }
                alert(errorMessage);
            }
        });
    }

    function showSuccessModal() {
        document.getElementById("successModal").style.display = 'block';
        document.getElementById("confirmBtn").addEventListener('click', function () {
            window.location.href = "\frontend\member_login.html"; // 註冊成功後跳轉至登入頁面
        });
    }

    // 會員註冊表單驗證檔案大小
    document.getElementById('photo').addEventListener('change', function (event) {
        const file = event.target.files[0];
        if (file && file.size > 5000000) { // 限制檔案最大為 5MB
            alert('檔案大小不能超過 5MB');
            event.target.value = ''; // 清空選擇的檔案
        }
    });
</script>

</body>

</html>